<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MFS Fun Fair 2026 - Cycling Club</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        /* --- æ¨£å¼è¨­å®š --- */
        :root {
            --primary: #1565C0;
            --accent: #FFB300;
            --bg-body: #F5F7FA;
            --surface: #FFFFFF;
            --text-main: #263238;
            --text-sub: #546E7A;
            --success: #2E7D32;
            --error: #C62828;
        }

        body {
            font-family: 'Noto Sans TC', 'Roboto', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0; padding: 0; height: 100vh;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden;
            -webkit-user-select: none; user-select: none; /* ç¦æ­¢é¸å–æ–‡å­— */
        }

        .app-container {
            width: 95%; max-width: 900px; height: 90vh;
            background: var(--surface);
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            display: flex; flex-direction: column;
            overflow: hidden; position: relative;
        }

        /* Header */
        .header {
            background: var(--primary); color: white;
            padding: 20px; text-align: center;
            border-bottom: 5px solid var(--accent);
            flex-shrink: 0; z-index: 10;
        }
        .h-school { font-size: 1.6rem; font-weight: 700; letter-spacing: 2px; }
        .h-event { font-size: 1.2rem; font-weight: 500; color: #E3F2FD; }
        .h-guard { 
            font-size: 1rem; background: rgba(255,255,255,0.15); 
            padding: 4px 15px; border-radius: 50px; margin-top: 8px; display: inline-block;
        }

        /* å…§å®¹å€ï¼šè¨­å®š z-index ç¢ºä¿æŒ‰éˆ•å¯é»æ“Š */
        .main-content {
            flex: 1; padding: 20px;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            position: relative; overflow-y: auto;
            z-index: 5; /* é—œéµä¿®å¾©ï¼šç¢ºä¿å…§å®¹åœ¨é®ç½©å±¤ä¹‹ä¸‹æ™‚ä¸è¢«å¹²æ“¾ */
        }

        /* é–‹å ´å‹•ç•«é®ç½© */
        #slogan-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--surface); z-index: 999;
            display: flex; justify-content: center; align-items: center;
            transition: opacity 0.5s ease; /* ç”¨ JS æ§åˆ¶æ·¡å‡º */
        }
        #slogan-overlay-text {
            font-size: 3rem; font-weight: 900; color: var(--primary);
            animation: popIn 2.5s ease-in-out forwards;
        }
        @keyframes popIn { 
            0% { transform: scale(0.8); opacity: 0; } 
            20% { transform: scale(1); opacity: 1; } 
            80% { opacity: 1; } 
            100% { transform: scale(1.1); opacity: 0; } 
        }

        /* é€šç”¨å…ƒä»¶ */
        .hidden { display: none !important; }
        .btn {
            border: none; outline: none; cursor: pointer;
            border-radius: 50px; font-weight: 500;
            transition: all 0.2s;
            touch-action: manipulation; /* å„ªåŒ–è§¸æ§åæ‡‰ */
        }
        .btn:active { transform: scale(0.95); }

        /* èªè¨€æŒ‰éˆ• */
        .btn-lang {
            padding: 12px 30px; font-size: 1.1rem;
            background: transparent; border: 2px solid var(--primary); 
            color: var(--primary); margin: 0 10px;
        }
        .btn-lang.active { background: var(--primary); color: white; }

        /* ä¸»è¦æŒ‰éˆ• (Start) */
        .btn-primary {
            background: var(--accent); color: #000;
            font-size: 1.4rem; font-weight: 700;
            padding: 15px 60px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
            margin-top: 30px; display: block;
        }
        .btn-primary:disabled { 
            background: #E0E0E0; color: #9E9E9E; 
            cursor: not-allowed; box-shadow: none; transform: none; 
        }

        /* è¼¸å…¥æ¡† */
        input[type="text"] {
            font-size: 1.5rem; padding: 10px; border: none; 
            border-bottom: 2px solid var(--primary);
            text-align: center; width: 60%; background: transparent; outline: none;
            display: block; margin: 0 auto 20px auto;
        }

        /* éŠæˆ²å€å¡Š */
        .question-box {
            background: #FAFAFA; width: 90%; min-height: 150px;
            border-radius: 16px; padding: 20px;
            display: flex; justify-content: center; align-items: center;
            margin: 20px 0; border: 1px solid #EEEEEE;
        }
        #question-text { font-size: 1.5rem; font-weight: 700; text-align: center; line-height: 1.4; }
        
        .options { display: flex; gap: 20px; width: 90%; justify-content: center; }
        .btn-opt { flex: 1; padding: 20px; font-size: 1.5rem; color: white; border-radius: 12px; }
        .btn-yes { background: var(--success); }
        .btn-no { background: var(--error); }

        .feedback { height: 30px; margin-top: 15px; font-size: 1.5rem; font-weight: 900; text-align: center; }
        .fb-correct { color: var(--success); }
        .fb-wrong { color: var(--error); }

        /* æ’è¡Œæ¦œ */
        .leaderboard-box {
            width: 90%; background: #FFF; border: 1px solid #E0E0E0;
            border-radius: 12px; overflow: hidden; margin-bottom: 20px; max-height: 250px; overflow-y: auto;
        }
        table { width: 100%; border-collapse: collapse; }
        th { background: var(--primary); color: white; padding: 10px; position: sticky; top: 0; }
        td { padding: 8px; border-bottom: 1px solid #eee; text-align: center; }
        .rank-1 { background: #FFF8E1; font-weight: bold; color: var(--accent); }

    </style>
</head>
<body>

    <audio id="bgm" preload="auto">
        <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_736854556a.mp3" type="audio/mpeg">
    </audio>

    <div class="app-container">
        
        <div id="slogan-overlay">
            <div id="slogan-overlay-text">å–®è»ŠçŸ¥è­˜çŸ¥å¤šå°‘</div>
        </div>

        <div class="header">
            <div class="h-school">ç‘ªåˆ©è«¾ç¥çˆ¶æ•™æœƒå­¸æ ¡</div>
            <div class="h-event">æ”¤ä½éŠæˆ²æ—¥ 2026</div>
            <div class="h-guard">å–®è»Šå­¸æœƒ</div>
        </div>

        <div class="main-content">
            
            <div id="home-screen" class="center-wrapper">
                <h1 style="color:var(--primary); font-size: 2.5rem; text-align: center; margin: 0 0 10px 0;">å–®è»ŠçŸ¥è­˜çŸ¥å¤šå°‘</h1>
                <p style="color:var(--text-sub); margin: 0 0 30px 0;">Cycling Knowledge Challenge</p>

                <h3 id="lbl-select-lang" style="color:#78909C; font-weight:400; margin-bottom: 15px;">è«‹é¸æ“‡èªè¨€ Select Language</h3>

                <div>
                    <button class="btn btn-lang" id="btn-zh" onclick="selectLanguage('zh')">ä¸­æ–‡</button>
                    <button class="btn btn-lang" id="btn-en" onclick="selectLanguage('en')">English</button>
                </div>

                <button id="btn-start" class="btn btn-primary" onclick="goToLogin()" disabled>
                    é–‹å§‹éŠæˆ² Start
                </button>

                <div style="position:absolute; bottom:10px; left:10px; font-size:0.8rem; color:#ccc;" onclick="clearData()">Admin Reset</div>
            </div>

            <div id="login-screen" class="center-wrapper hidden">
                <h2 id="lbl-welcome" style="color:var(--primary); margin-bottom: 20px;">Welcome</h2>
                <input type="text" id="username" placeholder="Enter Name..." maxlength="12" autocomplete="off">
                <button class="btn btn-primary" onclick="startGame()" id="lbl-confirm">GO</button>
            </div>

            <div id="game-screen" class="center-wrapper hidden" style="width:100%;">
                <div style="position:absolute; top:0; right:0; background:#E3F2FD; padding:5px 10px; border-radius:0 0 0 10px; font-weight:bold; color:var(--primary);">
                    â± <span id="game-timer">0.0</span>s
                </div>
                
                <div style="color:var(--text-sub); margin-bottom:5px;">
                    <span id="lbl-q">Q</span> 
                    <span id="q-num" style="color:var(--primary); font-weight:bold; font-size:1.2rem;">1</span> / 10
                </div>

                <div class="question-box">
                    <div id="question-text">Loading...</div>
                </div>

                <div class="options">
                    <button class="btn btn-opt btn-yes" onclick="submitAnswer(true)">
                        <span id="lbl-yes">YES</span>
                    </button>
                    <button class="btn btn-opt btn-no" onclick="submitAnswer(false)">
                        <span id="lbl-no">NO</span>
                    </button>
                </div>

                <div id="feedback-text" class="feedback"></div>
            </div>

            <div id="result-screen" class="center-wrapper hidden" style="width:100%;">
                <h2 id="lbl-gameover" style="margin-top:0; color:var(--text-main);">Finished</h2>

                <div style="display:flex; gap:30px; margin-bottom:15px;">
                    <div style="text-align:center;">
                        <div style="font-size:2rem; font-weight:900; color:var(--primary);" id="final-score">0</div>
                        <div style="font-size:0.8rem; text-transform:uppercase; color:#999;" id="lbl-score-title">Score</div>
                    </div>
                    <div style="text-align:center;">
                        <div style="font-size:2rem; font-weight:900; color:var(--primary);" id="final-time">0.0</div>
                        <div style="font-size:0.8rem; text-transform:uppercase; color:#999;" id="lbl-time-title">Time</div>
                    </div>
                </div>

                <div class="leaderboard-box">
                    <div style="background:#eee; padding:5px; text-align:center; font-size:0.9rem; font-weight:bold; color:#555;">TOP 50</div>
                    <table>
                        <tbody id="rank-body"></tbody>
                    </table>
                </div>

                <button class="btn btn-primary" onclick="resetGame()" id="lbl-next" style="padding: 10px 40px; font-size:1.2rem;">Next Player</button>
            </div>

        </div>
    </div>

    <div id="interstitial" class="hidden" style="position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.9); z-index:999; display:flex; justify-content:center; align-items:center;">
        <div id="inter-msg" style="font-size:2.5rem; font-weight:900; color:var(--primary);">Next...</div>
    </div>

    <script>
        // --- è¨­å®šèˆ‡è³‡æ–™åº« ---
        // ç¢ºä¿ DOM è¼‰å…¥å¾ŒåŸ·è¡Œåˆå§‹åŒ–
        window.onload = function() {
            // 2.5ç§’å¾Œç§»é™¤é–‹å ´é®ç½© (æ¯” CSS å‹•ç•«ç¨æ™šä¸€é»ï¼Œç¢ºä¿å‹•ç•«æ’­å®Œ)
            setTimeout(() => {
                const overlay = document.getElementById('slogan-overlay');
                overlay.style.opacity = '0'; // è¦–è¦ºæ¶ˆå¤±
                setTimeout(() => {
                    overlay.style.display = 'none'; // ç‰©ç†ç§»é™¤ (é€™æ­¥æœ€é‡è¦ï¼Œè§£æ±ºæŒ‰éˆ•ä¸èƒ½æŒ‰çš„å•é¡Œ)
                }, 500);
            }, 2500);
        };

        const questionDB = [
            { zh: "æ ¹æ“šé¦™æ¸¯æ³•å¾‹ï¼Œé¨å–®è»Šæ™‚å¿…é ˆæˆ´ä¸Šé ­ç›”ï¼Œå¦å‰‡å±¬é•æ³•ï¼Ÿ", en: "Is it mandatory by law to wear a helmet while cycling in HK?", a: false },
            { zh: "å–®è»Šæ‰‹è½‰å½æˆ–åœè»Šå‰ï¼Œå¿…é ˆç™¼å‡ºé©ç•¶çš„æ‰‹è™Ÿã€‚", en: "Cyclists must give hand signals before turning or stopping.", a: true },
            { zh: "åœ¨è¡Œäººè·¯ä¸Šé¨å–®è»Šæ˜¯åˆæ³•çš„å—ï¼Ÿ", en: "Is it legal to ride a bicycle on a pedestrian footpath?", a: false },
            { zh: "æ™šé–“é¨å–®è»Šï¼Œå¿…é ˆå±•ç¤ºè»Šé ­ç™½ç‡ˆåŠè»Šå°¾ç´…ç‡ˆã€‚", en: "You must show a white front light and red rear light at night.", a: true },
            { zh: "ææ…§è©©(Sarah Lee)æ˜¯æ›¾å¥ªå¾—å¥§é‹çç‰Œçš„é¦™æ¸¯å–®è»Šé‹å‹•å“¡ã€‚", en: "Sarah Lee is a HK cyclist who won Olympic medals.", a: true },
            { zh: "æ™®é€šå–®è»Šï¼ˆå–®äººåº§ä½ï¼‰å¯ä»¥é‹è¼‰ä¸€åä¹˜å®¢å—ï¼Ÿ", en: "Can you carry a passenger on a standard single-seat bicycle?", a: false },
            { zh: "é†‰é…’é¨å–®è»Šï¼ˆé…’å¾Œé§•é§›ï¼‰åœ¨é¦™æ¸¯å±¬æ–¼åˆ‘äº‹ç½ªè¡Œã€‚", en: "Cycling under the influence of alcohol is a criminal offence.", a: true },
            { zh: "å–®è»Šæ‰‹å¯ä»¥ä¸éµå®ˆäº¤é€šç´…ç‡ˆï¼Œåªè¦æ²’æœ‰è»Šã€‚", en: "Cyclists can ignore red lights if there are no cars.", a: false },
            { zh: "é¦™æ¸¯å–®è»Šé¤¨ï¼ˆå…·å‚™åœ‹éš›æ¨™æº–è³½é“ï¼‰ä½æ–¼å°‡è»æ¾³ã€‚", en: "The Hong Kong Velodrome is located in Tseung Kwan O.", a: true },
            { zh: "é¨å–®è»Šæ™‚ï¼Œå¯ä»¥é›™æ‰‹åŒæ™‚æ”¾é–‹æ‰‹æŸ„å—ï¼Ÿ", en: "Is it legal to ride with both hands off the handle bars?", a: false }
        ];

        const langPack = {
            zh: { startBtn: "é–‹å§‹éŠæˆ²", welcome: "æ­¡è¿åƒåŠ ", phName: "è«‹è¼¸å…¥å§“å", confirm: "é–‹å§‹æŒ‘æˆ˜", qPrefix: "é¡Œç›®", yes: "â­• æ˜¯", no: "âŒ é", correct: "ğŸ‰ æ­£ç¢º!", wrong: "âŒ éŒ¯èª¤!", nextQ: "ä¸‹ä¸€é¡Œ...", lastQ: "æœ€å¾Œä¸€é¡Œ!", gameOver: "æŒ‘æˆ°å®Œæˆ", scoreTitle: "åˆ†æ•¸", timeTitle: "æ™‚é–“", nextPlayer: "ä¸‹ä¸€ä½", thRank: "æ’å", thName: "å§“å", thScore: "åˆ†æ•¸", thTime: "æ™‚é–“" },
            en: { startBtn: "Start Game", welcome: "Welcome", phName: "Enter Name", confirm: "Start", qPrefix: "Q", yes: "â­• YES", no: "âŒ NO", correct: "ğŸ‰ Correct!", wrong: "âŒ Wrong!", nextQ: "Next...", lastQ: "Last One!", gameOver: "Finished", scoreTitle: "Score", timeTitle: "Time", nextPlayer: "Next Player", thRank: "Rank", thName: "Name", thScore: "Score", thTime: "Time" }
        };

        // --- è®Šæ•¸ ---
        let currentLang = null;
        let currentPlayer = "";
        let gameQuestions = [];
        let currentIndex = 0;
        let score = 0;
        let canAnswer = false;
        let timerInterval;
        let startTime = 0;

        // --- åŠŸèƒ½å‡½æ•¸ ---

        function selectLanguage(lang) {
            console.log("Language Selected:", lang); // Debug Log
            currentLang = lang;
            
            // UI æ›´æ–°
            document.getElementById('btn-zh').classList.toggle('active', lang === 'zh');
            document.getElementById('btn-en').classList.toggle('active', lang === 'en');
            
            const btnStart = document.getElementById('btn-start');
            btnStart.disabled = false;
            btnStart.innerText = langPack[lang].startBtn;

            // å˜—è©¦æ’­æ”¾éŸ³æ•ˆ (åŠ äº† try-catch é˜²æ­¢å ±éŒ¯å¡æ­»)
            try {
                const audio = document.getElementById('bgm');
                audio.volume = 0.2;
                let playPromise = audio.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.log("Audio play prevented automatically (Standard browser policy). User will hear sound on next interaction.");
                    });
                }
            } catch(e) { console.log("Audio Error ignored"); }
        }

        function goToLogin() {
            if (!currentLang) return;
            document.getElementById('lbl-welcome').innerText = langPack[currentLang].welcome;
            document.getElementById('username').placeholder = langPack[currentLang].phName;
            document.getElementById('lbl-confirm').innerText = langPack[currentLang].confirm;

            switchScreen('login-screen');
            setTimeout(() => document.getElementById('username').focus(), 100);
        }

        function startGame() {
            const nameInput = document.getElementById('username');
            const name = nameInput.value.trim();
            if(!name) { nameInput.style.borderBottom = "2px solid red"; return; }
            nameInput.style.borderBottom = "2px solid var(--primary)";

            currentPlayer = name;
            // éš¨æ©Ÿé¸ 10 é¡Œ
            gameQuestions = [...questionDB].sort(()=>0.5-Math.random()).slice(0, 10);
            currentIndex = 0; score = 0;

            document.getElementById('lbl-q').innerText = langPack[currentLang].qPrefix;
            document.getElementById('lbl-yes').innerText = langPack[currentLang].yes;
            document.getElementById('lbl-no').innerText = langPack[currentLang].no;

            switchScreen('game-screen');
            
            startTime = Date.now();
            if(timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(()=>{
                const diff = (Date.now() - startTime)/1000;
                document.getElementById('game-timer').innerText = diff.toFixed(1);
            }, 100);

            renderQuestion();
        }

        function renderQuestion() {
            document.getElementById('q-num').innerText = currentIndex + 1;
            const q = gameQuestions[currentIndex];
            document.getElementById('question-text').innerText = (currentLang === 'zh') ? q.zh : q.en;
            
            const fb = document.getElementById('feedback-text');
            fb.innerText = "";
            fb.className = "feedback";
            canAnswer = true;
        }

        function submitAnswer(choice) {
            if(!canAnswer) return;
            canAnswer = false;

            const correct = gameQuestions[currentIndex].a;
            const fb = document.getElementById('feedback-text');

            if(choice === correct) {
                score += 10;
                fb.innerText = langPack[currentLang].correct;
                fb.classList.add('fb-correct');
            } else {
                fb.innerText = langPack[currentLang].wrong;
                fb.classList.add('fb-wrong');
            }

            setTimeout(()=>{
                currentIndex++;
                if(currentIndex < 10) {
                    showInterstitial();
                } else {
                    finishGame();
                }
            }, 1500); // ç¸®çŸ­ç­‰å¾…æ™‚é–“åˆ° 1.5ç§’ï¼Œç¯€å¥å¿«ä¸€é»
        }

        function showInterstitial() {
            const inter = document.getElementById('interstitial');
            const msg = document.getElementById('inter-msg');
            inter.classList.remove('hidden');
            
            if(currentIndex === 9) {
                msg.innerText = langPack[currentLang].lastQ;
                msg.style.color = "var(--error)";
            } else {
                msg.innerText = langPack[currentLang].nextQ;
                msg.style.color = "var(--primary)";
            }

            setTimeout(()=>{
                inter.classList.add('hidden');
                renderQuestion();
            }, 1000);
        }

        function finishGame() {
            clearInterval(timerInterval);
            const finalTime = ((Date.now() - startTime)/1000).toFixed(2);
            saveRecord(currentPlayer, score, parseFloat(finalTime));

            document.getElementById('lbl-gameover').innerText = langPack[currentLang].gameOver;
            document.getElementById('lbl-score-title').innerText = langPack[currentLang].scoreTitle;
            document.getElementById('lbl-time-title').innerText = langPack[currentLang].timeTitle;
            document.getElementById('lbl-next').innerText = langPack[currentLang].nextPlayer;

            document.getElementById('final-score').innerText = score;
            document.getElementById('final-time').innerText = finalTime;

            switchScreen('result-screen');
            renderLeaderboard();
        }

        function saveRecord(name, score, time) {
            let data = JSON.parse(localStorage.getItem('mfs_cycling_2026')) || [];
            data.push({name, score, time});
            localStorage.setItem('mfs_cycling_2026', JSON.stringify(data));
        }

        function renderLeaderboard() {
            let data = JSON.parse(localStorage.getItem('mfs_cycling_2026')) || [];
            // æ’åºï¼šåˆ†æ•¸é«˜å„ªå…ˆï¼Œåˆ†æ•¸ç›¸åŒå‰‡æ™‚é–“çŸ­å„ªå…ˆ
            data.sort((a,b) => {
                if(b.score !== a.score) return b.score - a.score;
                return a.time - b.time;
            });

            const tbody = document.getElementById('rank-body');
            tbody.innerHTML = "";
            
            // æ¨™é¡Œè¡Œ
            const headerRow = `<tr><th style="width:15%">#</th><th>${langPack[currentLang].thName}</th><th>${langPack[currentLang].thScore}</th><th>${langPack[currentLang].thTime}</th></tr>`;
            tbody.innerHTML = headerRow;

            data.slice(0, 50).forEach((d, i)=>{
                const tr = document.createElement('tr');
                if(i===0) tr.classList.add('rank-1');
                tr.innerHTML = `<td>${i+1}</td><td>${d.name}</td><td>${d.score}</td><td>${d.time}s</td>`;
                tbody.appendChild(tr);
            });
        }

        function resetGame() {
            document.getElementById('username').value = "";
            currentLang = null;
            document.getElementById('btn-zh').classList.remove('active');
            document.getElementById('btn-en').classList.remove('active');
            const btnStart = document.getElementById('btn-start');
            btnStart.disabled = true;
            btnStart.innerText = "é–‹å§‹éŠæˆ² Start";
            
            switchScreen('home-screen');
        }

        function switchScreen(screenId) {
            ['home-screen', 'login-screen', 'game-screen', 'result-screen'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        function clearData() {
            if(prompt("Reset Password:") === "8888") {
                if(confirm("Delete all records?")) {
                    localStorage.removeItem('mfs_cycling_2026');
                    alert("Deleted.");
                    renderLeaderboard();
                }
            }
        }
    </script>
</body>
</html>